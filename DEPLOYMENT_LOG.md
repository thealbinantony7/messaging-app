# üöÄ LUCENT Deployment Log

**Date**: January 3, 2026
**Commit**: `HEAD` (Phase 6.4)

## üì¶ Release Notes (v1.3.0 - "Invite Link Authority")

### Critical Fix
- **Production-Safe Invite Links**: Invite URLs now use `APP_BASE_URL` environment variable with **mandatory validation**. Server refuses to start if missing or invalid.
- **Zero Localhost Leakage**: Removed all fallbacks to `localhost:5173`. Production deployments are now guaranteed to use the correct domain.

### Backend Hardening
- **Startup Validation**: Added `validateEnvironment()` function that validates `APP_BASE_URL`, `DATABASE_URL`, `REDIS_URL`, and `JWT_ACCESS_SECRET` before server starts.
- **Format Validation**: `APP_BASE_URL` must start with `http://` or `https://`, preventing misconfiguration.

### Developer Experience
- **Clear Error Messages**: Server crashes with explicit error messages listing missing environment variables.
- **Documentation**: Updated `DEPLOY_GUIDE.md` with `APP_BASE_URL` requirement.

## üõ†Ô∏è Infrastructure
- **Database**: PostgreSQL 15+ (Hardened constraints)
- **Frontend**: React + Vite (Build Verified: PASS)
- **Backend**: Fastify + WebSockets (Environment Validated)

## ‚úÖ Verification
- Build Status: **PASS**
- TypeScript Check: **PASS**
- Startup Validation: **ENFORCED**

---

## üì¶ Release Notes (v1.2.0 - "Read Semantics Finalization")
**Date**: January 3, 2026
**Commit**: `352a4a3` (Phase 6.3)


### Critical Improvements
- **Deterministic Read Receipts**: Finalized backend-authoritative read logic. Red ticks (read) now derive strictly from `read_at` field.
- **Database Integrity**: Added `CHECK` constraints to `messages` table to ensure `read_at >= delivered_at >= created_at`.
- **Sender Validation**: Backend now explicitly prevents users from marking their own messages as read.
- **Membership Protection**: WebSocket read events are now rejected if the user is not a member of the conversation or the message doesn't belong to the conversation.

### Simplification
- **Zero-Cilent Heuristics**: Removed visibility-detection, scroll-tracking, and other client-side hacks for read receipts.
- **"Dumb" Frontend**: Frontend now simply emits a `mark_read` intent for the last message on mount; backend handles all validation and state transitions.

### Stability
- **Idempotent Updates**: Repeated `mark_read` calls are now validated and ignored after the first write, preventing redundant broadcasts.
- **Cross-Platform Consistency**: Identical behavior on iOS, Android, and Desktop by design.

## üõ†Ô∏è Infrastructure
- **Database**: PostgreSQL 15+ (Hardened constraints)
- **Frontend**: React + Vite (Build Verified: PASS)
- **Backend**: Fastify + WebSockets (Validation Hardened)

## ‚úÖ Verification
- Build Status: **PASS**
- TypeScript Check: **PASS**
- Invariant Validation: **100% Correct**

---

## üì¶ Release Notes (v1.1.0 - "Stabilization")
**Date**: January 1, 2026
**Commit**: `0e2f6c8`


### Critical Fixes
- **500 Internal Server Errors**: Resolved by repairing database schema (added missing `invite_tokens` and message columns).
- **White Void UI**: Fixed by ensuring backend returns valid data structure and handling fetch errors.
- **"No Messages Yet" Bug**: Fixed by enforcing backend authority on empty state logic.
- **Invite Links**: Fixed silent failures with strict validation and robust error handling.
- **Online Status**: Switched to backend-authoritative calculation (`NOW() - last_seen_at < 30s`).

### Improvements
- **Performance**: Removed client-side heuristics and reconciliation logic.
- **Reliability**: Strict "Backend is Truth" architecture implemented.
- **Developer Experience**: Added invariant checks in development mode.

## üõ†Ô∏è Infrastructure
- **Database**: PostgreSQL 15+ (Schema updated)
- **Frontend**: React + Vite (Build Verified)
- **Backend**: Fastify (Build Verified)

## ‚úÖ Verification
- Build Status: **PASS**
- TypeScript Check: **PASS**
- Critical Bug Audit: **9/9 Fixed**

---
*Generated by Antigravity*
